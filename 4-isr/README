标题:Allwinner H3中断机制说明

cortexA和ARM11的协处理器p15的C12寄存器支持，可以用于设定异常向量表的地址，向量表地址必须时32字节对齐的


1.allwinner H3的中断向量表有两个0xffff0000和0x00000000,0xffff0000已经被BROM使用,如果
  希望我们希望使用自定意的驱动,我们可以使用0x00000000,如何使用这就要具体阅读ARM的GIC相
  关文档了.这里给出本部分示例代码的中断初始化流程,以下均已PA9的作为外部中断为例.
1)初始化PA9为外部中断,下降延触发,通过与PA9相关的外部中断控制寄存器进行设定
2)初始化GIC中断控制器,通过配置GIC相关的寄存器进行设定
3)复制ARM的中断异常向量表到0x00000000
4)设置ARM中断向量表的地址为0x00000000,从过CP15中的相应寄存器进行设定
5)开启系统的中断,通过ARM的CPSR的对应位进行设定
6)设定PA9中断处理函数
7)使能GIC控制器对应的中断号AW_IRQ_EINTA
8)等待中断到来

2.allwinner H3中断程序的执行流程
1)PA9上有下降延跳变,此时EINTA中断发生
2)ARM监测到IRQ异常发生,查找在0x00000000上的异常中断向量表,进入IRQ的中断处理程序
3)IRQ处理程序,从GIC的GICC_IAR获取中断号
4)处理程序之后根据中断号,调用之前安排的对应中断号的处理程序
5)中断处理函数执行完毕,软件清除中断标志位

3.中断向量表的重定位
Allwinner H3的BROM加在SD程序的方法是,从SD卡开始地址后偏移8KB处开始的,BROM会将一定大
小的数据原板复制到从0x00000000开始的IRAM中,并且对这部分数据有固定格式的数据,为此我们
并不能直接将异常向量表直接编译链接在0x00000000开始的地址上,我们需要将异常向量表链接到
程序的,其他地方,之后在程序中再将异常向量表,复制到0x00000000开始处,之所以可以这样做主要
是因为0x00000000开始处的数据,在BROM完成应用程序启动之后就没有用了.
